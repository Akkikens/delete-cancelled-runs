name: Test Cleanup Action

on:
  push:
    branches: [main, feature/targeted-superseded-runs]
  workflow_dispatch:

concurrency:
  group: test-cleanup-${{ github.ref }}
  cancel-in-progress: true

jobs:
  test-job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Run test
        run: |
          echo "This is a test job that will be cancelled by concurrency"
          sleep 10

  cleanup-cancelled-runs:
    runs-on: ubuntu-latest
    needs: test-job
    if: always()
    permissions:
      actions: write
    steps:
      - name: Test cleanup with dry-run
        uses: ./
        with:
          workflow-file: 'test-cleanup.yml'
          max-deletions: '10'
          dry-run: 'true'

